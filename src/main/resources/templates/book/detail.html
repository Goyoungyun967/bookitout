<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>상세페이지</title>
<link rel="stylesheet" href="/css/detail.css">    
<!-- jQuery CDN -->
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script src="/js/detail.js"></script>
</head>
<body>
	<th:block th:include="common/header"></th:block>
	
	<main class="content">
        <div class="inner">
            <div class="info-wrap">
                <div class="book">
                    <ul>
                    	<li style="display: none;"><span th:text="${book.bookNo}" id="bookNo"></span></li>
                        <li><h2 th:text="${book.bookName}"></h2></li>
                        <li><p><span th:text="${book.bookWriter}"></span> / 발행(출시)일자: <span th:text="${book.publicationDate}"></span></p></li>
                        <li>
                            <img src="/image/book-sample.jpg" alt="도서 이미지">
                        </li>
                    </ul>
                </div>
                <div class="info">
                    <div>
                        <span class="badge">무료배송</span>
                        <span class="badge">소득공제</span>
                    </div>
                    <div>
                        <span th:text="${book.bookPrice}" class="price"></span><span>원</span>
                    </div>
                    <div>
                        <p>
                            <span class="left">배송안내</span>
                            <span class="right">무료배송</span>
                        </p>
                        <div class="clear"></div>
                        <P class="right">
                            <span class="badge">무료배송</span>
                            <span>내일(8/1, 목 오전 7시 전) 도착</span>
                        </P>
                        <P>
                            <span class="right">기본배송지 기준</span>
                        </P>
                    </div>
                    <div class="container">
                        <button class="btn-type1 btn open-btn" type="button">
                            <i class="fa-solid fa-location-dot"></i>
                            	매장 재고·위치
                        </button>
                    </div>
    
                    <div class="modal-container">
                        <div class="modal">
                            <div class="content">
                                <div class="text-wrap" id="modal-data-wrap">
                                	<!-- 
                                    <h2>당신이 누군가를 죽였다</h2>
                                    <table class="center_inventory">
                                        <thead>
                                            <tr>
                                                <th style="width: 20%;">지점명</th>
                                                <th style="width: 65%;">주소</th>
                                                <th style="width: 15%;">재고 수량</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="center : ${list}">
                                                <td th:text="${center.admin_name}"></td>
                                                <td th:text="${center.admin_addr}"></td>
                                                <td th:text="${center.centerBookCount}"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    -->
                                </div>
                            </div>
                            <button class="close-btn">닫기</button>
                        </div>
                        <div class="dim-layer"></div>
                    </div>
                </div>
            </div>
            
            <div class="clear"></div>

            <hr>
            
            <div class="clear"></div>
            
            <div class="book-detail-img">
                <img src="/image/book-detail.jpg">
            </div>
            
            <div class="clear"></div>

            <hr>
            
            <div class="clear"></div>

            <div class="comment">
                <!-- 댓글 입력 -->
                <div th:if="${session.member != null}" class="inputCommentBox">
                    <form action="/book/insertComment" method="post">
                        <ul>
                            <li>
                                <!-- <span class="material-icons">account_box</span> -->
                                <span class="user-icon"><i class="fa-solid fa-circle-user"></i></span>
                            </li>
                            <li>
                            <!-- 
                                <input type="hidden" name="noticeCommentWriter" th:value="${session.member.memberId}">
                                <input type="hidden" name="noticeRef" th:value="${n.noticeNo}"> -->
                                <div class="input-item">
                                    <textarea name="noticeCommentContent" placeholder="댓글을 입력하세요!"></textarea>
                                </div>
                            </li>
                            <li>
                                <button class="btn-point" type="submit">등록</button>
                            </li>
                        </ul>
                    </form>
                </div>                
            </div>
            
            <div class="clear"></div>

            <div class="buy-info">
                <div class="inner">
                    <div class="price-info">
                        <span>총 상품 금액</span>
                        <span class="price" th:text="${book.bookPrice}"></span><span>원</span>
                    </div>
                    <div class="bottom-btnBox">
                        <span class="btn-type1 countPM">
                            <!-- 장바구니 수량 증감 -->
                            <button class="minus" onclick="minus();">-</button>
                            <input type="text" id="count" value="1" style="width: 20px;" readonly>
                            <button class="plus" onclick="plus();">+</button>
                        </span>
                        <button class="btn-type1 btn"><span><i class="fa-solid fa-gift"></i></span>선물하기</button>
                        <button class="btn-type2 btn">장바구니</button>
                        <button class="btn-type3 btn">바로구매</button>
                    </div>
                </div>
            </div>
            
            <div class="clear"></div>
        </div>
    </main>
    <script>
    $(document).ready(function(){
    	// 모달 팝업 오픈&클로즈
   	    var $openBtn = $('.open-btn'),
   	        $closeBtn = $('.close-btn'),
   	        $modal = $('.modal-container'),
   	        $dimLayer = $('.dim-layer');

   	    // console.log($openBtn);
   	    
   	    $openBtn.click(function () {
   	        modalShow();
   	    });
   	    
   	    $closeBtn.click(function () {
   	        modalHide();
   	    });
   	    
   	    $dimLayer.click(function () {
   	        modalHide();
   	    });
   	    
   	    function modalShow() {
   	        $modal.addClass('active');
   	        $dimLayer.show();
   	        // console.log('show button click');
   	        
   	        const bookNo = $("#bookNo").text();
   	        // console.log(bookNo);
   	        $("#modal-data-wrap").empty();
   			$.ajax({
   				url : "/book/ajax1",
   				type : "get",
   				data : {bookNo : bookNo},
   				dataType : "json",
   				success : function(data){
   					// console.log(data);
					// console.log(typeof data);
   					// console.log(data.length);
   					for(let i = 0; i < data.length; i++){
   						const h2 = $("<h2></h2>");
   						h2.append(data[i].bookName);
   						//h2.text();
   						
   						const table = $("<table class='center_inventory'>");
   						
   						const thead = $("<thead>");
   						const tr1 = $("<tr>");
   						
   						const th1 = $("<th style='width: 20%;'>");//<th style="width: 20%;"></th>
   						th1.text("지점명");//<th style="width: 20%;">지점명</th>
   						tr1.append(th1);
   						
   						const th2 = $("<th style='width: 65%;'>");
   						th2.text("주소");
   						tr1.append(th2);
   						
   						const th3 = $("<th style='width: 15%;'>");
   						th3.text("재고 수량");
   						tr1.append(th3);
   						
   						thead.append(tr1);
   						/*
   						<th style="width: 20%;">지점명</th>
   	                    <th style="width: 65%;">주소</th>
   	                    <th style="width: 15%;">재고 수량</th>
   						*/
   						
   						const tbody = $("<tbody>");
   						const tr2 = $("<tr>");//<tr></tr>
   						
   						const td1 = $("<td>");//<td></td>
   						td1.append(data[i].adminName);
   						tr2.append(td1);
   						
   						const td2 = $("<td>");
   						td2.append(data[i].adminAddr);
   						tr2.append(td2);
   						
   						const td3 = $("<td>");
   						td3.append(data[i].centerBookCount);
   						tr2.append(td3);
   						
   						tbody.append(tr2);
   						
   						/*
   						<td th:text="${center.adminName}"></td>
   	                    <td th:text="${center.adminAddr}"></td>
   	                    <td th:text="${center.centerBookCount}"></td>
   						*/
   						
   						table.append(thead);
   						table.append(tbody);
   						
   						$("#modal-data-wrap").append(table);
   					}
   				},
   				error : function(){
   					console.log("에러");
   				}
   			});
   	    }
   	    
   	    function modalHide() {
   	        $modal.removeClass('active');
   	        $dimLayer.hide();
   	        // console.log('close button click');
   	    }
   	});

   	// 구매 수량 증감
   	function minus(){
   	    const count = document.querySelector("#count");
   	    const currentCount = count.value;//value속성으로 읽어오면 문자열타입
   	    if(currentCount == 1){
   	        alert("최소 주문 수량은 1개 입니다.");
   	    }else{
   	        count.value = Number(currentCount) - 1;
   	    }
   	}

   	function plus(){
   	    const count = document.querySelector("#count");
   	    const currentCount = count.value;//value속성으로 읽어오면 문자열타입
   	    if(currentCount == 10){
   	        alert("최대 주문 수량은 10개 입니다.");
   	    }else{
   	        count.value = Number(currentCount) + 1;
   	    }
   	}

   	// 가격 천단위 콤마 찍기
   	// let price = document.querySelector(".price").innerText();
   	// let result = price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
   	// console.log(result);

   	// const price = $(".price").text();
   	// console.log(price.toLocaleString());
   	// 123,456,789
   	// `toLocaleString()`는 인자가 없이 사용을하면 사용자의 PC의 환경 로컬을 따라서 표시를 해줍니다.

   	// console.log(num.toLocaleString('ko-KR'))
   	// 123,456,789
   	// 로컬을 인자로 넣으면 해당 로컬의 포맷으로 표시해줍니다.

   	// const number = 123456789.123456
   	// console.log(number.toLocaleString('ko-KR', { maximumFractionDigits: 4 }))
   	// 123,456,789.1234
   	// option 인자로 전달되는 객체 안에는 maximumFractionDigits 값이 4로 지정되어 있어서 소숫점 4자리까지 표시
    </script>

	<th:block th:include="common/footer"></th:block>
</body>
</html>