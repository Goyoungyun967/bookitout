<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>해외 도서</title>
<link rel="stylesheet" href="/css/main.css">
<style>
	* {
    padding: 0;
    margin: 0;
    outline: none;
}
.content {
    width: 1200px;
    margin: 0 auto;
}


/*
.list-btn {
    width: 70px;
    height: 30px;
    border-radius: 7px;
    font-weight: bold;
    margin-top: 20px;
}

.btn-list {
margin-bottom: 10px;
}
*/
</style>
</head>
<body>
	<th:block th:include="common/header"></th:block>
	
	<main class="content">
		<section class="section book-list-wrap">
			<div class = "book-list">
				<div class="list-header">
					<p><a href = "/book/listFore?reqPage=1&type=1&genre=5">해외 도서</a></p>
					<ul>
						<li><a href = "/book/listFore?reqPage=1&type=1&genre=2">문학</a></li>
						<li><a href = "/book/listFore?reqPage=1&type=1&genre=3">재테크</a></li>
						<li><a href = "/book/listFore?reqPage=1&type=1&genre=4">기타</a></li>						
					</ul>					
				</div>
				
				<div class="list-contect">
					<div class="list-array-title">						

                        <ul class="array-title">
                        	<li><a th:href = "@{/book/listFore(reqPage=1,type=2,genre=${genre})}">상품명순</a></li>
							<li><a th:href = "@{/book/listFore(reqPage=1,type=3,genre=${genre})}">출간일순</a></li>
							<li><a th:href = "@{/book/listFore(reqPage=1,type=4,genre=${genre})}">등록일순</a></li>
							<li><a th:href = "@{/book/listFore(reqPage=1,type=5,genre=${genre})}">저가격순</a></li>
							<li><a th:href = "@{/book/listFore(reqPage=1,type=6,genre=${genre})}">고가격순</a></li>	
                        </ul>
					</div>
					
					<div class="book-info">
						<table class="book-info-tbl">
							<tr th:each="book : ${list}">                             
                                <td class="check-box" style="width:5%; vertical-align: baseline;">
                                    <input type="checkbox" name="checkbox" id="checkbox">
                                </td>

                                <td style="width:20%;">
                                	<img id=book-img th:src="@{/book/{filename}(filename=${book.bookImg})}" >                                    
                                </td>

                                <td style="vertical-align: baseline;">
                                    <div class="book-details">
                                        <div class="book-first" style="width:55%;" th:text="${book.bookName}"></div>
                                        <div class="book-second">
                                            <span class="book-writer" th:text="${book.bookWriter}"></span>
                                            <span class="book-publisher" th:text="${book.bookPublisher}"></span>
                                        </div>
                                        <div class="book-third">
                                            <span class="book-price" th:text="${book.bookPrice}"></span>
                                            <span class="publication-date" th:text="${book.publicationDate}"></span>
                                            <span class="enroll-date" th:text="${book.enrollDate}"></span>
                                        </div>
                                    </div>
                                </td>

                                <td class ="btn-list" style="width:20%; vertical-align: baseline;">
                                
                                	<div th:if="${session.member !=null}">
                                		<button class ="btn-list"  type="button" id="listCart" name="bookCart" th:onclick="addCart([[${book.bookNo}]])">장바구니</button>
	                                    <button class ="btn-list"  type="button" id="listBuy"  name="bookBuy">바로구매</button>    
                                	</div>
                                	<div th:if="${session.member ==null}">
                                		<button class ="btn-list"  type="button" id="listCart" name="bookCart" onclick="loginMsg()">장바구니</button>
	                                    <button class ="btn-list"  type="button" id="listBuy"  name="bookBuy" onclick="loginMsg()">바로구매</button>    
                                	</div>
	                                                      
                                </td>
                            </tr>
						</table>
					</div>
				</div>
				
				<div class="pagination" id="pageNavi" th:utext="${pageNavi}"></div>
			
			</div>
		</section>		
	</main>
	
	<script>
	
	
		function loginMsg() {
			swal({
				title : "로그인 필요",
				text : "로그인 페이지로 이동하겠습니까?",
				icon : "info",
				buttons : {
					cancel : {
						text : "아니오",
						value : false,
						visible : true,
						className : "btn-cancel",
						closeModel : true
					},
					confirm : {
						text : "예",
	    				value : true,
						visible : true,
						className : "btn-confirm",
						closeModel : true	
					}
				}
			}).then(function(isConfirm){
				if(isConfirm){
					location.href="/member/loginFrm";
				}		
			});
		}
	
		function addCart(bookNo){
			$.ajax({
				url : "/cart/selectCart",
				type: "get",
				data : {bookNo:bookNo},
				success : function(data){
					const cartNo = data;
					if(cartNo==0){
						$.ajax({
							url : "/cart/addCart",
							type : "get",
							data : {bookNo : bookNo},
							success : function(data){
								swal({
									title : "장바구니 담기",
									text : "해당 책이 장바구니에 담겼습니다.",
									icon : "info"
								});
							},
							errer :  function(){
								console.log("에러");
							}							
						});
					}else {
						$.ajax({
							url : "/cart/plusCart",
							type : "get",
							data : {cartNo:cartNo},
							success : function(data){
								swal({
									title : "책 수량 추가",
									text : "장바구니에 담겨있는 책입니다. 추가 하시겠습니까?",
									icon : "info"									
								});
							},
							error : function() {
								console.log("에러");
							}							
						});
					}
				},
				error : function() {
					console.log("에러");
				}				
			});
		}
	
	
	
	</script>
	
	<th:block th:include="common/footer"></th:block>
	
</body>
</html>